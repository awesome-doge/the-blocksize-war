
# 第十七章– 用戶激活軟分叉


在 2017 年 2 月 25 日發送到比特幣郵件列表的電子郵件中，比特幣中的 UASF 解決當前僵局並激活 SegWit 的想法似乎也起源於化名開發者 Shaolinfry：

> *絕對多數哈希功率信號的問題在於它引起了對礦工的不必要的關注，而礦工可能會變得不必要地政治化。已經被誤解為投票的礦工可能會感受到代表社區“做出決定”的壓力：誰是和不是信號成為公眾關注的焦點，並可能給他們毫無準備的礦工施加壓力。一些礦工可能無法升級，或者可能不想參與他們正確的軟分叉。然而，那個礦工現在可能成為否決每個人激活的唯一原因，軟分叉是一個選擇加入的功能！這種情況似乎與比特幣系統的自願性質背道而馳，在該系統中，所有級別的參與都是自願的，並且通過均衡的激勵機制保持誠實。*

> **..**

> **這裡討論的替代方案是“國旗日激活”，節點在未來的預定時間開始執行。這種方法比基於哈希功率的激活觸發器需要更長的前置時間，但提供了許多優點，並且可能提供了更好的權衡。**

2017 年 3 月 12 日，Shaolinfry 正式確定了他的提議，它被稱為 BIP 148。這個想法是為了迫使礦工通過共識規則來標記對 SegWit 的支持，從而激活它。在某種程度上，這是激活另一個軟分叉的軟分叉。強制礦工標記計劃於 2017 年 8 月 1 日開始，大約四個半月後開始。這可以在激活窗口到期之前激活原始的 SegWit 軟分叉。

> ***動機***

> *Segwit 增加了區塊大小，修復了交易延展性，並使腳本更易於升級以及帶來許多其他好處。*

> *希望礦工在此 BIP 生效之前通過儘早激活 Segwit 來響應此 BIP。否則此 BIP 將導致在 2017 年 11 月 15 日午夜結束之前強制激活現有的隔離見證部署。*

> ***規格***

> *所有時間均根據過去時間中位數指定。*

> *此 BIP 將在 2017 年 8 月 1 日午夜（紀元時間 1501545600）和 2017 年 11 月 15 日午夜（紀元時間 1510704000）之間處於活動狀態，如果現有的隔離見證部署在紀元時間 15015456 之前未鎖定或激活，則此 BIP 將變為活動狀態隔離見證被鎖定。*

> *當此 BIP 處於活動狀態時，所有塊都必須將 NVersion 標頭前 3 位與位字段 (1<<1) 一起設置為 001（根據現有的 Segwit 部署）。未按要求發出信號的塊將被拒絕。*

從小型阻擋者的角度來看，這個想法極具爭議性並且是非常冒險的舉動。首先，到目前為止，大多數小型阻滯劑的敘述都是關於耐心和僅以冷靜和安全的方式改變共識規則的。這是一個危險的升級：它需要礦工標記支持，如果他們不這樣做，可能會導致鏈分裂。其次，這是非常危險的，因為如果 BIP 148 UASF 失敗（這似乎很有可能），它可以將主動權交給更大的阻撓者。在戰爭的這個時候，大塊頭分裂成幾個派系：例如，在認為克雷格賴特是中本聰的人和認為他是騙子的人之間；在認為 Bitcoin Unlimited 是一個強大的想法的人和認為它有缺陷的人之間；以及那些留下來推出新的初始硬幣產品的人和那些仍然專注於比特幣的人之間。然而，值得稱讚的是，到目前為止，小阻滯者大多團結在一起。這是小防守方的關鍵優勢，並幫助他們在戰爭中獲得了很大的吸引力。來自小街區陣營的這場有爭議的比賽有可能將他們一分為二，這對他們的事業來說可能是毀滅性的。

例如，Gregory Maxwell 是小型阻滯劑方面最有影響力的思想家之一，他反對 UASF，並在 2017 年 4 月 14 日的一封電子郵件中明確闡述了這一觀點：

> *我不支持 BIP148 UASF 的一些原因與我支持 Segwit 的原因相同：比特幣之所以有價值部分是因為它具有高安全性和穩定性，Segwit 精心設計以支持和增強人們現在可以信賴的工程完整性進入未來。*

> *我不覺得 BIP148 中提出的（原文如此）方法真正符合隔離見證本身設定的標準，或者該社區協議開發中現有的最佳實踐。*

> *BIP148 的主要缺陷是通過強制激活現有（非 UASF Segwit）節點，它幾乎可以保證在較小的中斷級別。*

> *隔離見證經過精心設計，因此在隔離見證激活後，未經修改的老礦工可以繼續_完全_不間斷地運行。*

> *較舊的節點將不包括 Segwit 支出，因此即使它們沒有 Segwit 支持，它們的塊也不會無效。他們可以按照自己的時間表升級到它。非參與礦工在 Segwit 激活後承擔的唯一風險是，如果其他人開采了一個無效的區塊，他們會擴展它，這是許多礦工在間諜挖礦中已經經常承擔的風險。*

> *我不認為這是一個可怕的提議：它比許多山寨幣所做的許多事情都設計得更好，但只是不符合我們的正常標準。我尊重 BIP 148 作者的動機。如果您的目標是盡可能快地激活 Segwit，那麼利用 80% 以上已經支持 Segwit 原始版本的現有節點是非常有用的。*

> *但最快的支持不應該是我們的目標，作為一個社區——總有一些魯莽的山寨幣或中心化系統可以支持比我們更快的東西——試圖匹配只會削弱我們在精心設計和穩定方面的獨特價值。*

> *“首先不要傷害。” 我們應該使用可用的破壞性最小的機制，而 BIP148 提案不符合該測試。聽到一些人——Reddit 上的非開發者等等——有些人甚至將 148 的強制孤兒視為一種美德，這是對行為不端的礦工的懲罰。我不能（原文如此）更強烈地不同意這種觀點。*

> *當然，我不反對 UASF 的一般概念，但一般來說，軟分叉（任何類型的）不需要冒挖礦中斷的風險，就像 Segwit 的激活不需要一樣。UASF 是最早的一種軟分叉，也是中本聰實踐的唯一一種分叉。P2SH 是根據日期激活的，所有之前的都是基於時間或高度。我們引入了基於礦工的激活，作為* *在生態系統和諧* *的常見情況下使比特幣更穩定的過程的一部分**。看到 UASF 被描繪成新事物有點奇怪。*

> *重要的是，用戶不能在我們可以避免的範圍內對生態系統的任何一部分仁慈——無論是開發人員、交易所、聊天論壇還是採礦硬件製造商。最終，比特幣的規則之所以有效，是因為它們是由用戶集體執行的——這就是比特幣的原因，也是人們可以信賴的原因：規則不容易改變。*

> *還有一些其他的 UASF 提案可以避免強制中斷——通過定義一個新的見證位並允許未升級到 Uasf 的礦工和節點繼續未升級，我認為它們非常優越。它們的部署速度會更慢，但我認為這不是缺陷。*

> *我們應該有耐心。比特幣是一個應該適用於所有年齡段並為人類提供長期動力的系統——十年後，幾年的爭議將變得毫無意義。但是，我們因穩定和誠信而贏得的聲譽，作為人們可以信賴的貨幣體系，將意味著一切。*

> *如果這些討論出現，它們會以提醒人們比特幣不會隨心所欲地輕易改變的形式出現，即使這些想法顯然是好的，以及如何保護它免受像所有競爭系統一樣被管理世界曾經使用的錢被管理。🙂*

> *所以要有耐心，不要走捷徑。隔離見證是一個很好的改進，我們應該尊重它，因為我們知道它已經足夠好等待，但是它已經被激活以我們知道的最好的方式來完成。*

最早支持 UASF 的知名比特幣開發者之一是 Luke Dashjr，他首先發現瞭如何使 SegWit 成為軟分叉。盧克在這裡真的挺身而出，支持替代性共識規則，而幾乎沒有其他人這樣做。不過，以他的個性，這不太可能困擾他，似乎也沒有。小區塊陣營中最受尊敬的開發人員之一，為 SegWit 軟分叉編寫了大部分代碼的 Pieter Wuille 也反對 BIP 148。 2017 年 5 月，在與 Luke 的互聯網中繼聊天中，Pieter 發表了以下評論：

> *我的期望是，每個與經濟相關的完整節點在算力未能採用 Bip148 代碼數小時後都會恢復使用它*

> *…*

> *小盧克：我覺得你瘋了*

需要注意的是，Pieter 很快就為“瘋狂”的評論道歉。鑑於 Pieter 和 Gregory 等開發人員的觀點，Bitcoin Core 現在似乎極不可能發布實施 BIP 148 的客戶端。如果 UASF 計劃要成功，具有諷刺意味的是，小型攔截器將不得不運行具有不同特性的替代客戶端。共識規則，就像大型阻止者對 Bitcoin XT、Bitcoin Classic 和 Bitcoin Unlimited 所做的那樣。

這正是發生的事情：Luke 最終發布了一個實現 BIP 148 的客戶端，用戶代理標籤為“/Satoshi:0.14.2/UASF-Segwit:0.3(BIP148)/”。還鼓勵用戶繼續運行 Bitcoin Core 並更改用戶代理 ID 以顯示對 BIP 148 的支持，這在當時似乎也是一種流行的做法。有些人認為這是一種不好的做法，因為客戶實際上並沒有執行 BIP148 規則，但其他人則回應說這是出於意圖，表明用戶會在 8 月 1 日之前升級。有些人指出這有點虛偽，因為這正是小攔路人曾經嘲笑和批評大攔路人的那種行為。

2017 年 5 月上旬，我在香港坐下來與 UASF 最重要的幕後支持者之一聊天。我與之交談的開發人員為 UASF 客戶端編寫了代碼，並維護了幾個支持 UASF 的活動網站。我向他解釋說 UASF 是有風險的，對比特幣共識規則保持耐心很重要。他給出了一個漫長而有力的回應。“在正常時期，你是對的”，他斷言，“但是，現在不是正常時期，我們處於戰爭之中。” 他繼續說道：“比特幣處於危機狀態，比特大陸惡意利用 ASICBoost 漏洞，SegWit 修復了這個漏洞，我們需要緊急修復這個漏洞。這是緊急情況，因此我們沒有時間採取正常、耐心的方法。” 他接著解釋說，在戰爭中，你並不總是有機會選擇正確的時間。他意識到距離 UASF 啟動只有幾個月的時間，但他解釋說，小型攔截器目前在戰爭中處於主導地位，無法保證這種情況會持續下去。“現在是拿出大武器的時候了，”他宣稱，“當我們強大的時候。” 他繼續說道：“為了比特幣的未來，我們別無選擇，我們需要立即採取行動，去核並決定性地贏得這場戰爭。如果我們不這樣做，我們就有失敗的風險，比特幣就會死。” 這位開發人員似乎已經考慮了所有情況，並確信 BIP 148 會起作用。在他看來，BIP 148 是一個軟分叉，是當前共識規則的一個子集，這一事實是一個重大優勢，將有助於迫使礦工轉向 BIP 148 鏈。他的觀點是，BIP 148 是一種威脅，礦工們會儘早擺脫壓力，激活 SegWit，這樣 2017 年 8 月的軟分叉就永遠不會真正發生。“BIP 148 包含代碼，如果 SegWit 已經激活，則它不適用，”他解釋說。

雖然最初這個想法在小塊陣營內引起爭議，但到 2017 年 5 月，它獲得了巨大的吸引力。Dragons' Den 現在處於完整戰役模式，支持 BIP 148 和 UASF。Samson Mow 甚至組織、銷售和分發了一頂正面繡有 UASF 字母的帽子。這頂帽子通常是軍用顏色的，在比特幣會議和活動中被小型阻撓者戴上，以表明他們對這場草根運動的支持。在這一點上，UASF 的討論只在小區塊社區內部盛行，而大區塊和更廣泛的加密貨幣行業大多忽略了它。直到 2017 年 5 月底，這個想法才在小街區營地之外得到更廣泛的探索。

從戰術的角度來看，大型攔截者反應太慢，理解UASF太慢。大塊頭應該看到小塊陣營中潛在的分裂，並試圖突出和利用它，就像小塊攔截者在大塊陣營中對潛在分裂所做的那樣。相反，他們大多忽略了 UASF。接近 5 月底，我與一位最著名的大型阻撓者進行了交談，討論了 UASF。他向我解釋說他不相信 Gregory Maxwell 真的反對 UASF；他解釋說，這只是他的“普通謊言和遊戲”。看起來，此時的不信任程度如此之高，再加上對比特幣運作方式的截然不同的理解，大型阻止者幾乎無法分辨小型阻止者在做什麼。在我看來，小阻攔者終於開始行動並留下了一個空缺。如果這場戰爭要繼續下去，大塊頭們需要做出反應並利用這個空缺，但他們似乎不知道該怎麼做。

UASF 似乎也真正關心大型阻滯劑。開戰之初，他們就大大低估了小型阻擊者陣營的規模和影響力，期望在戰爭中輕鬆取勝。大阻擊者經常嘲笑小阻擊者無足輕重和幼稚。然而，在這一點上，在三次失敗的硬分叉嘗試之後——出乎他們意料的失敗——大多數大塊頭現在似乎高估了小塊頭的力量和影響力。實際上，較小的阻滯劑遠沒有他們想像的那麼強大。到目前為止，他們成功擊敗大型阻止者的主要原因是他們對比特幣的卓越理解、大型阻止者本身的戰術失誤以及比特幣對有爭議的協議規則變化的固有彈性。由於不完全了解，至少在某種程度上，大攔網者反而將他們的失敗歸咎於狡猾而強大的小攔網者的精明操作。因此，大攔網似乎崇敬小攔網，他們中的許多人害怕UASF，他們認為這是小攔網的下一個大戲。他們對它給他們的戰術機會視而不見。因此，他們未能利用這個機會。

在這一點上，UASF 幾乎沒有來自加密貨幣交易所的支持。我當時與之交談的大多數交易所 CEO 要么預計 UASF 會失敗，要么他們甚至不知道它是什麼。在小街區營地之外，對 UASF 的經濟支持水平微乎其微。這是小型阻止者的冒險舉動，在我看來，他們可能會被拋在不被視為比特幣的較低工作量證明區塊鏈上。大型阻止者應該考慮的是發布“反軟分叉”，它禁止塊中的 BIP 148 標誌。該鏈可能擁有經濟多數和算力多數。這個計數器 UASF 還可以確保它是一個乾淨的分裂，非 UASF 鏈不再容易被消滅。然而，這根本不是大型阻攔者的想法。他們想要增加硬分叉區塊大小；他們沒有實施反軟分叉的專業知識或願望。

吳忌寒似乎對 UASF 的活動極為憤怒。對他來說，UASF 破壞了他建立的關於礦工對協議規則有重大影響的說法。2017 年 5 月 28 日，Jihan 在推特上發布了#UASF 標籤，並附上了一張瓊斯鎮大屠殺遇難者的照片。他對 UASF 的憤怒和恐懼似乎很強烈。

6月中旬，與吳忌寒掛鉤的交易所ViaBTC在平台上掛牌了BIP 148期貨。這顯然是幾個月前從 Bitfinex 和他們的 Bitcoin Unlimited 令牌中獲得的想法。這是企圖破壞 BIP 148，就像 Bitfinex 期貨破壞了 Bitcoin Unlimited 一樣。然而，合同條款很奇怪，有些被操縱。如果有人投資了 BIP 148 代幣，則只有在 BIP 148 代幣鍊和原始規則鏈（非 BIP 148 鏈）都繼續存在的情況下，您才能獲得回報。這顯然不是 BIP 148 支持者想要的。他們認為原始規則鏈將不復存在，特別是因為原始規則鏈很容易從 BIP 148 鏈中消失。所以，投資於依賴於非 BIP 148 鏈的持續存在的代幣對於 BIP 148 的支持者來說意義不大。該合同未能實現任何顯著的交易量，並且似乎沒有破壞 BIP 148 的原因。

2017 年 6 月 14 日，比特大陸發布了一篇博客，其中概述了針對 UASF 的應急計劃：

> *BIP148 對交易所和其他業務非常危險。BIP148 背後沒有任何重大經濟支持的跡象，當它作為區塊鏈存在時，經濟支持很可能是基於猜測。UASF鏈背後的挖礦活動可能會在沒有通知的情況下停止，購買BIP148宣傳的投資者可能會失去所有投資。任何決定在分叉點之後支持 UASF 代幣的交易所都需要考慮與之相關的停滯風險。*

> *…*

> *UASF 鏈存在原鏈被淘汰的風險。如果沒有應急預案，在UASF分叉點之後發生在原鏈上的所有經濟活動都將面臨被消滅的風險。這對整個比特幣生態系統產生了災難性的後果。UASF 是針對不同意在不增加區塊大小的情況下立即激活 SegWit 的用戶和企業的攻擊，這是全球比特幣社區在 2016 年 2 月制定的香港協議中的一個非常重要的條款。*

> *…*

> *此計劃適用於用戶激活的硬分叉或 UAHF*

> *…*

> *比特大陸將在 BIP148 分叉點之後的至少 72 小時內使用我們自己的採礦運營商提供的一定百分比的哈希率對該鏈進行挖掘。除非情況需要，比特大陸可能不會立即將開采的區塊發佈到公共網絡，這意味著比特大陸將首先私下開採這樣的鏈。我們打算在以下情況下向公眾發布開采的區塊（非詳盡清單）：*

> *BIP148鏈被激活，隨後獲得挖礦行業的大力支持，BIP148之後的IE已經成功分鏈；*
>
>
>
> *大塊硬分叉的市場情緒* [ *強勁*](https://twitter.com/el33th4xor/status/867065862657900545)*，**經濟理由驅使我們挖掘它，例如，匯率有利於大塊比特幣；*
>
>
>
> *如果已經有大量其他礦工公開開採一個大區塊鏈，並且我們認為我們在該鏈上進行挖礦是合理的。在這種情況下，我們也會考慮加入那個鏈，放棄我們的私有鏈，這樣公共 UAHF 鏈就不會面臨被重組的風險。*

> *一旦比特大陸開始公開開採 UAHF 鏈，我們將持續開採並忽略短期經濟激勵。我們相信包括調整區塊大小選項的路線圖將為用戶提供更好的服務，因此我們預計它會在長期內吸引更高的市場價格。*

比特大陸的計劃是在 UASF 即將激活的同時激活一個硬分叉，這將增加區塊大小限制。硬分叉計劃甚至包括一個區塊大小限制增加計劃。區塊大小限制將從 2017 年 8 月的 2 MB 開始，然後在 2019 年 8 月以額外的、預先確定的步驟逐漸增加到 16.8 MB。這個計劃似乎是某種威脅，針對的是 UASF 的支持者。大型攔截器將獲得他們的新硬分叉鏈，他們認為小攔截器迫切希望阻止他們實現這一目標。

雖然姬寒似乎沒有意識到，但這個計劃實際上對 UASF 事業是非常有利的，因為這意味著 UASF 鏈比原規則鏈更有可能獲得工作量證明的領先，因為比特大陸表示它已經計劃轉移到替代的硬分叉鏈。除此之外，比特大陸還計劃在 72 小時內秘密開採新的硬分叉鏈。這是一個非常糟糕的舉動，如果計劃是讓硬分叉鏈獲得任何牽引力，因為沒有人能夠看到該鏈，或運行支​​持它的客戶端，並且交易所將無法支持該代幣。目前尚不清楚是什麼激發了這篇博文。季寒似乎是非常的憤怒，連忙制定了一個挫敗對手的計劃，卻完全沒有想好。季寒當然應該宣布的是，如果遇到UASF，他會繼續挖掘原始規則鏈，同時安排一個反UASF。然而，這會讓他被 1 MB 塊困住，所以也許他覺得他沒有太多選擇。

在龍之巢穴內，小塊頭們高興地慶祝比特大陸的博文，因為它幾乎向他們保證了完全勝利。不過，也有人語氣更加謹慎，“只因季寒說他會做傻事，別以為他會”。在我看來，這種更為謹慎的立場是正確的做法。隨著 8 月 1 日的臨近，季寒很可能會意識到他的計劃毫無意義並轉向其他更有效的事情。

隨著 UASF 截止日期的臨近，大型阻攔者處於落後狀態，因為他們不知道如何有效應對。就好像他們沒有可行的選擇一樣。看起來大塊頭的攔路虎終於要慘敗了，他們知道這一點。他們需要某種面子練習。