
#  第五章– 隔離見證

在 Scaling Bitcoin Hong Kong 的第二天的第一場會議中，在一個主要時段，比特幣開發者 Pieter Wuille 發表了關於稱為隔離見證（SegWit）的內容的演講。隔離見證是一種增加比特幣區塊大小的方式，新客戶端不會不兼容（即它是軟分叉而不是硬分叉）。比特幣交易由各種組成部分組成，其中之一是簽名，授權支出。根據數據量，此簽名通常是交易的最大部分。隔離見證是一種新的交易格式，其中籤名不需要包含在舊塊中，舊塊仍然有 1 MB 的限制。升級到 SegWit 的客戶端會看到一個包含這些簽名的新區塊；對於這些新客戶，舊的 1 MB 塊大小限制被刪除，取而代之的是 400 萬個單位的“重量限制”。重量限制被定義為非簽名數據量（以字節為單位）加上隔離簽名數據量（以字節為單位）的四倍。這意味著簽名數據在計算中得到了折扣，但總體限制將在 2 MB 左右，這當然是許多人想要的：塊大小限制增加到 2 MB 左右。

一位名叫 Luke Dashjr 的佛羅里達州比特幣開發者發現了一個黑客，這使得隔離見證成為兼容（軟分叉）比特幣升級的可能。盧克被認為是最極端的小塊攔截器之一，也是大塊社區中與格雷戈里麥克斯韋並列的另一個仇恨人物。盧克一點也不害怕自己的非共識意見在人群中脫穎而出。在某種程度上，忠誠的天主教徒和七個孩子的父親是技術社區的 Cassandra；異常刺耳。然而，盧克顯然對比特幣有很強的技術理解，他明顯的非線性思維讓他看到與其他人不同的東西，這可能幫助他構思了其他開發人員無法完全解決的黑客。

對於那些理解它的人來說，SegWit 似乎是一個絕妙的雙贏提議。網絡可以達到 2 MB 塊，但我們避免了升級不兼容的問題。除此之外，舊錢包和新錢包可以無縫交互，升級完全是可選的：用戶可以升級到 SegWit，也可以像以前一樣繼續使用網絡。從舊錢包的角度來看，新式交易將缺少簽名。但是，一旦交易被包含在區塊鏈中，錢包仍然會看到交易並將其識別為有效。隔離見證還意味著交易容量的增長速度可能比簡單的區塊大小限制增加硬分叉更快，因為我​​們不需要等待每個人都升級，我們可以合理快速地開始使用新的區塊空間。

SegWit 不僅看起來是比特幣的堅實勝利，而且似乎是一場絕妙的戰術舉措，無論是有意還是無意，來自區塊大小戰爭中的小塊頭。這個提議簡直太好了，沒有任何有效的論據反對它。Gavin 將不得不支持 SegWit 提案，而且在大多數情況下他都這樣做了。[^1] 如果規模化會議是為了爭取時間和發布這個想法的幕後陰謀，那麼玩得好！需要注意的是，我不是在這裡提出這種指責。大型阻止者會因為他們的硬分叉運動而被阻止，並且會贏得重要的時間。我記得當時與一些長期存在的大型阻撓者交談。他們告訴我，他們認為他們被他們認為是一個巧妙的提議打敗了。

當然，這都是理論上的。在假設的世界裡，每個人都理解隔離見證，所有參與者都是理性的，這是一個絕妙的舉動。由於人們對區塊大小的限制爭論不休，該提案取消了限制並用其他東西代替，從而否定了這一論點。然而，實際情況遠非如此。SegWit 異常複雜，幾乎沒有人理解它。這是小塊頭高估對手智力，或者至少高估對手理解計算機科學方面能力的第一個主要例子。例如，事後看來，該提案應該被簡單地稱為“增加到 2 MB 塊”之類的東西。取而代之的是，它有一個非常神秘和令人困惑的名字，對於大型阻攔者來說，這聽起來非常可疑，誰想要一些他們可以理解的清晰和簡單的東西。大型阻擋者似乎察覺到這一舉動來自他們的敵人，他們想要自己的方式。這場戰爭是關於控制的，他們想要控制。他們將 SegWit 視為一種額外的拖延機制，以阻止更大的區塊。因此，在沒有真正了解 SegWit 的情況下，他們就反對它。

隨著 SegWit 在技術社區中開始受到關注，大型阻礙者之間的誤解和誤解開始增加。這些誤解和謠言包括（但當然不限於）以下內容：

* SegWit 不是“真正的”區塊大小限制增加，它只是壓縮交易（確實，使用 SegWit，未升級的客戶端仍然只能看到 1 MB 的塊，但對於硬分叉也是如此，因為舊節點強制執行 1 MB限制。使用 SegWit，升級後的節點確實可以看到大於 1 MB 的塊，這大概是更大的阻止者想要的）；
* 比特幣基於數字簽名鏈，SegWit 刪除了數字簽名鏈，從而破壞了鏈並產生了安全風險；
* 如果礦工沒有為 SegWit 升級並產生一個塊，這個塊將被升級的客戶端拒絕。這增加了鏈分裂的風險（只有在礦工使用專門設計來分裂鏈的定制軟件時才會發生這種情況）；
* 如果用戶升級到隔離見證，他們將無法向未升級的用戶發送資金；
* SegWit 升級可以逆轉，然後任何人都可以竊取 SegWit 輸出中的硬幣（逆轉 SegWit 將是一個硬分叉）。

許多誤解是無意義的，因此無法輕易反駁。它們似乎源於這樣一個事實，即大多數人一開始並不真正了解比特幣交易的基礎知識。例如，經常提到短語“SegWit 格式地址”，但 SegWit 沒有新的或不同的地址格式。如果人們無論如何都不了解比特幣交易的機制，那麼解釋 SegWit 的機制是根本不可能的。

事實證明，隔離見證非常複雜，以至於 Jeff Garzik 似乎都無法理解。他認為費用競標會有“兩個桶”：一個與舊的 1 MB 限制有關，另一個與新的 400 萬個單位重量限制有關。[^2] 實際上，區塊大小和區塊權重這兩個限制的構造使得它們彼此一致，因此是等效的，因此只有一個費用市場桶。這不是對傑夫的批評；隔離見證是一個極難完全理解和理解的提議，事實證明這是該想法的一個根本弱點。這只是說明，雖然從技術上講，SegWit 可能是一種可靠的前進方式，但由於所涉及的複雜性，根本不可能將其傳達給比特幣社區。

除了高度複雜之外，還有一些反對 SegWit 的有效論據。為了獲得隔離見證的好處和增加的區塊空間，用戶錢包必須升級以支持新的交易格式。這可能比簡單的硬分叉增加需要更多的時間，後者不需要更改交易格式。然而，應該指出的是，一旦一些用戶升級到 SegWit，它就會為升級較慢的落後者釋放塊空間。

對於許多小型阻止者來說，讓用戶升級到新的交易格式是 SegWit 的一部分。除了提供塊大小限制增加之外，新的 SegWit 交易格式還修復了一些錯誤，即第三方交易的延展性和 sighash 操作的非線性擴展。我不會在這裡詳細介紹。簡而言之，第三方交易延展性本質上是一個問題，因為任何人都可以在區塊鏈確認之前更改比特幣交易的交易 ID，並使交易保持有效。這給過去無法跟踪資金的一些錢包和商家帶來了問題。它本質上是一個錯誤。解決這個問題對於稱為閃電的第二層交易網絡也有些必要。

sighash 操作的非線性擴展意味著，隨著交易中輸入數量的增加，驗證交易所需的散列操作數量呈二次增加而不是線性增加。這種擴展性問題阻礙了更大的區塊，因為攻擊者可能會創建交易，而這些交易需要很長時間才能驗證網絡是否會陷入停頓。這個問題實際上是小型阻止者反對增加區塊大小限制的主要原因之一，因為攻擊者可以利用這個弱點。攻擊者可以構建一個包含許多此類大型交易的塊，這樣普通計算機可能需要數小時才能進行驗證。因此，對於許多小型阻止者來說，解決這個問題是增加區塊大小限制的先決條件。他們嘲笑大型阻撓者忽視這一弱點並缺乏對抗心態而自滿。相反，大型阻止者似乎相信比特幣幾乎堅不可摧或反脆弱，正如他們經常所說的那樣。小阻撓者將系統的穩健性歸功於開發團隊的辛勤工作和謹慎，但這並沒有得到社區應有的重視。大多數大型攔截器認為修復這些錯誤不應該是優先事項；關鍵是塊大小限制。但這並沒有得到社區應有的重視。大多數大型阻止者認為修復這些錯誤不應該是優先事項；關鍵是塊大小限制。但這並沒有得到社區應有的重視。大多數大型攔截器認為修復這些錯誤不應該是優先事項；關鍵是塊大小限制。

無論如何，在使用 SegWit 時，這些錯誤已得到修復。從小型攔截器的角度來看，這是完全合理的。使用 SegWit，我們可以為無法很好擴展的舊有錯誤交易保留 1 MB 的舊限制，同時為沒有錯誤的新交易提供更多可用空間。從工程的角度來看，SegWit 看起來很棒。問題再次在於復雜性。大多數比特幣用戶不知道這些問題，也不關心它們。比特幣不僅僅是工程和計算機科學。它也是一個社會系統，一個實時支付系統，一個經濟系統，一個金融系統。從這些角度來看，隔離見證是否有意義還不太清楚。

儘管 SegWit 的想法於 2015 年 12 月在香港舉行的會議上提出，但它仍然需要實施、分析、測試和討論。直到 2016 年 11 月，SegWit 終於在 Bitcoin Core 中發布，漫長的等待了 10 多個月。儘管它是在 Bitcoin Core 中發布的，但這並不意味著人們可以開始使用 SegWit。這是對協議規則的更改，或者更準確地說，是對協議規則或軟分叉的收緊。這意味著有一種激活方法。選擇的激活機制是礦工必須表示支持。如果 95% 的區塊在 2,016 個區塊的難度調整窗口中表示支持，則軟分叉將在另一個兩週的寬限期後激活。如果 12 個月後仍未激活，則升級將中止。

對於大型阻滯劑，這種激活方法是不合適的。他們爭辯說，你永遠不會在任何事情上達成 95% 的一致。這將允許任何僅擁有 5% 算力的小型礦工聯盟阻止這種變化。一些大型攔截器將 95% 的激活閾值視為一種拖延策略，並且更喜歡 Bitcoin XT 中的 75% 閾值。大型阻止者傾向於將礦工標誌視為投票，一個決策過程。在這種情況下，95% 似乎沒有多大意義。另一方面，較小的攔截器將標誌視為一種信號機製或安全功能。在他們看來，用戶決定了協議規則，礦工信號是必要的，以確保安全過渡到新規則。它不被視為政治投票過程。

此外，95% 不是憑空挑出來的。最後三個比特幣軟分叉都使用相同的 95% 閾值激活：2015 年 7 月的 BIP 66（將簽名限制為 DER 編碼）；2015 年 12 月的 BIP 65（檢查鎖定時間驗證）；和 BIP 68、BIP 112 和 BIP 113，這三個不同的軟分叉在 2016 年 7 月同時激活。 SegWit 剛剛選擇繼續使用相同（或稍作修改）的激活方法。應該指出的是，之前的這些軟分叉進展並不完美。2015 年 7 月 BIP 66 的激活導致了幾個區塊的鏈分裂，因為礦工似乎未能為軟分叉升級，儘管他們已標記為已升級。2016 年 7 月的升級也比預期的要長，社區不得不遊說礦池以表示支持。

鑑於上述歷史和社區中新的緊張局勢，當 SegWit 發佈時，礦工是否會激活 SegWit 存在相當大的不確定性。事實上，其中一個礦池 ViaBTC 已經表示，即使在客戶端發布之前，他們也不會支持升級。[^3] 雖然 SegWit 是一種工程魔法，但它對平息衝突中的緊張局勢並沒有起到任何作用。

[^1]: https://twitter.com/gavinandresen/status/800405563909750784](https://twitter.com/gavinandresen/status/800405563909750784

[^2]: https://www.slideshare.net/jgarzik/bitcoin-status-report-on-chain-scaling-aug-2016](https://www.slideshare.net/jgarzik/bitcoin-status-report-onchain-scaling-aug-2016

[^3]: https://bitcoinmagazine.com/articles/segregated-witness-officially-introduced-with-release-of-bitcoin-core-1477611260](https://bitcoinmagazine.com/articles/segregated-witness-officially-introduced-with-release-of-bitcoin-core-1477611260

