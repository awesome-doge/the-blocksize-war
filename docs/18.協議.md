
# 第十八章– 紐約協議

2017 年 5 月 22 日，Digital Currency Group (DCG) 的 Barry Silbert 在紐約安排了一次會議，旨在解決衝突。吳忌寒出席。這導致了另一個協議。發布了以下稱為紐約協議 (NYA) 的文件。它寫道：

> *我們同意立即支持比特幣協議的以下並行升級，這些升級將同時部署並基於原始 Segwit2Mb 提案：*

> *以 80% 的閾值激活隔離見證，在位 4 發出信號*
>
>
>
> *在六個月內激活一個 2 MB 的硬分叉*

> *我們還致力於技術機制的研究和開發，以改善比特幣社區中的信號，並部署通信工具，以便在安全解決方案的設計、集成和部署方面與生態系統參與者更緊密地協調增加比特幣的容量。*

> *我們歡迎所有公司、礦工、開發者和用戶加入我們，為未來的比特幣做準備。*

> *簽署的公司集團代表了比特幣生態系統的重要組成部分。截至 5 月 25 日，該小組代表：*

> *58家公司分佈在22個國家*
>
>
>
> *83.28% 的算力*
>
>
>
> *月鏈交易量 51 億美元*
>
>
>
> *2050 萬個比特幣錢包*

> *另外，截至 5 月 24 日，以下公司承諾提供技術和工程支持以測試和支持升級軟件，並協助公司做好升級準備：*

> *阿布拉 | 比特俱樂部網絡| 比特幣網| 比特狂怒 | 比特圍棋 | 比特大陸 | 比特支付 | 區塊鏈 | 博客 | 比特幣| 圈 | 分類帳 | RSK 實驗室 | 沙波*

> *如果您希望從您的團隊中提供專門的技術和工程支持，請告訴我們，我們會將您包括在上面的列表中。*

該協議基於 2017 年 3 月比特幣開發商和研究員塞爾吉奧·勒納 (Sergio Lerner) 的一項早期提案。這個想法是將 SegWit 和非見證硬分叉塊大小增加到 2 MB。對接近 Barry 的人說，這被認為是一種妥協，有些人想要 SegWit，有些人想要硬分叉，因此現在每個人都可以得到他們想要的東西。有人向我解釋說，巴里擔心網絡已陷入僵局，必須採取一些措施才能繼續前進。據說該協議本身是由 DCG 員工 Meltem Demirors 起草的。這份文件讓 Jihan 有機會挽回面子，這是一種應對 UASF 潛在威脅的方法，就像一個月前的萊特幣協議一樣。

該協議簽署方的數量和重要性令人印象深刻。總共有 58 個簽署人，包括 Gavin Andresen、Roger Ver 的 Bitcoin.com、Jihan Wu 的 Bitmain 和 Brian Armstrong 的 Coinbase。儘管許多（33 個簽署方）是 DCG 投資組合公司，但在該集團之外也得到了來自許多交易所和礦池的廣泛支持。因此，該領域的許多觀察家得出結論，區塊大小問題現在終於得到解決，協議的成功實施幾乎是不可避免的。這份協議對於較大的阻攔者來說是一次重大的政變和成就，當時他們很弱。這看起來像是衝突的一個重大轉折點。較大的阻擋者幾乎被淘汰出局，但現在他們突然再次佔據優勢。

然而，大型阻撓者對協議並不完全滿意。畢竟，它包括隔離見證，這是他們不太熱衷的東西。但它似乎確實做了他們想做的事情，那就是“啟動比特幣核心”。這就是 Roger Ver 如何證明他的支持是合理的。他聲稱，雖然他不喜歡協議本身，但至少它會擺脫比特幣核心。一些大型阻撓者似乎對該協議持懷疑態度，而大型阻滯者陣營中更極端的一方則反對該協議。該協議承諾在硬分叉之前激活 SegWit，硬分叉“在六個月內”激活。該協議稱硬分叉和軟分叉將“同時部署”，但軟分叉將首先激活。一些大型阻撓者擔心第一步可能會發生，然後簽署方可以保釋協議，

至於小阻撓者，他們在紐約沒有代表，他們的意見也沒有反映在協議中。沒有具有雙重含義或相互矛盾的陳述的句子；它似乎完全是由大型攔截器方編寫的。值得注意的是，該協議沒有提到比特幣用戶控制協議或在更改協議規則之前需要用戶支持的想法。NYA 甚至沒有對用戶應該有發言權的想法表示贊同。它被描述為該領域的大型企業以自上而下的方式對用戶施加規則。如果比特幣像這樣運作，就會破壞該貨幣的核心價值主張。NYA 簽署人似乎並不認為在激活分叉之前遊說和說服用戶很重要。

除了破壞比特幣的核心價值主張外，這也是一種糟糕的策略。比特幣用戶想要掌控一切，不喜歡被告知該做什麼。因此，NYA 感覺就像是 Bitcoin XT、Bitcoin Classic 和 Bitcoin Unlimited 的重演。他們又犯了同樣的錯誤，只不過這次得到了更多的行業支持。然而，值得注意的一件事是，該行業中幾個非常重要且不斷增長的名字並未簽署 NYA。最引人注目的是 Bitfinex，它可能是當時最具經濟意義的公司。本地比特幣（當時最大的 P2P 交易所）、Poloniex、BitMEX 和礦池 Slush 也明顯缺席。

對於小型阻止者來說，協議中最容易分開的部分是“以 80% 的閾值激活隔離見證，在第 4 位發出信號”。這沒什麼意義，因為 SegWit 使用第 1 位激活，而不是第 4 位。礦工可以使用第 4 位進行標記，但這實際上不會激活 SegWit。顯然，根據與出席會議的某人的談話，Jihan 堅持這一點，也許是因為他幾個月來一直受到壓力，需要使用 bit 1 來表示對 SegWit 的支持，而且他不想屈服於小阻撓者的要求。但是，使用該位激活 SegWit 是不可能的，因此不清楚會發生什麼。

幾乎在 NYA 發布後不久，2017 年 5 月 22 日，比特幣和挖礦軟件開發商 James Hillard 提出了解決這個 bit 4 困境的解決方案，稱為 BIP 91：

> *我想提出一個實現，獨立於第二部分完成 Barry Silbert 提案的第一部分：*

> *“以 80% 的閾值激活隔離見證，在第 4 位發出信號”*

> *這裡的目標是最大限度地減少鏈分裂風險和網絡中斷，同時最大限度地提高向後兼容性，並仍然使用第 4 位在 80% 閾值下快速激活隔離見證。*

> *通過立即激活隔離見證並與任何 HF 分開，我們可以快速擴展，而不會冒著匆忙組合隔離見證 + HF 的風險，這幾乎肯定會導致廣泛的問題。*

James 提議 SegWit 將分兩個階段激活，兩個軟分叉。第一個軟分叉將使用 NYA 中提到的 80% 礦工信號閾值激活，並將通過第 1 位強制發送 SegWit 信號。這將激活最終的軟分叉，即 SegWit 本身。這也使升級與 BIP 148（UASF）兼容，因為這也使通過比特 1 的 SegWit 信令成為強制性的。實際上，BIP91 是由 James Hillard 和 BIP 148 的作者 Shaolinfry 共同編寫的。 最終發布了一個客戶端，稱為 Segsignal，它是 Bitcoin Core 補丁以支持 BIP 91。BIP 91 是一個非常積極和快速的升級機制，如果 269 個塊在 336 個塊信令窗口中標記支持，則激活 80% 的閾值。

至於全面實施 NYA 的客戶，很快發現這將被稱為 BTC1，主要開發人員將是 Jeff Garzik，他曾在 2010 年首次實施後幾周向 Satoshi 提議增加區塊大小限制。被要求使 BTC1 與 BIP 91 兼容並通過第 1 位激活 SegWit，認為從技術角度來看，通過第 4 位激活是無稽之談。起初，傑夫拒絕了，儘管他的推理似乎有些混亂。

5 月 29 日，BitGo 首席執行官 Mike Belshe 的一封電子郵件被洩露。它包含NYA的計劃和時間表。需要注意的是，雖然BitGo被NYA列為為升級提供技術支持的公司之一，但他們本身並不是協議的簽署方。該協議甚至在最底部寫道：“注意：BitGo 被錯誤地包括在最初公佈的名單中。這已經得到糾正。” 通過與一些 BitGo 員工交談，我的理解是，他們要求移除該公司，認為託管人和支付處理者應該保持中立並支持分裂的雙方。無論如何，洩露的電子郵件包含了一個提議的時間表，包括軟件的 alpha 版本、測試網的啟動以及在 7 月 21 日之前開始的信號。

比特幣社區的許多人憤怒地發現，NYA 客戶的開發和計劃是秘密進行的，而不是在公共郵件列表上。比特幣應該是一個開放系統，接受公開審查。推動共識變革推出的秘密郵件列表被認為與比特幣背道而馳。然而，私下進行的原因很明確：如果在公開場合進行，小塊頭無疑會在他們所做的事情上挑剔，使他們的提議顯得無力。SegWit 非常複雜，另外一個團體試圖在對其了解非常有限的情況下推出它。事後看來，在閉門造車的情況下進行大部分流程是錯誤的，因為缺乏審查似乎會導致更多錯誤。

2017 年 5 月末，由於不兼容的 SegWit 激活（通過位 4）給 Jeff 帶來的壓力是巨大的。小型阻攔者和 Dragons' Den 參與者意識到這是 BTC1 客戶端的一個主要缺陷，如果他們說服 Jeff 進行此更改並採用 BIP 91，隔離見證可能最終會在比特幣上激活。激活發生後，小型攔截器可以阻止 NYA 的第二部分，即硬分叉。社交媒體上充斥著關於 Jeff 拒絕採用 BIP 91 造成的破壞性和不合作的評論，他的收件箱中可能充滿了來自整個技術社區的類似要求和指責。

最後，在 2017 年 6 月 5 日，Jeff 在壓力下屈服，將 BIP 91 包含在他的 BTC1 客戶端中。小阻撓者現在已經成功了；NYA 客戶現在實施了 UASF。龍穴內，熱鬧非凡。

硬分叉的激活邏輯此時也發生了變化；現在據說 BTC1 客戶端中的硬分叉計劃在 SegWit 激活後三個月激活（如果 SegWit 真的要激活），而不是在六個月後激活。但是，我無法理解代碼是如何實現激活邏輯的，並且圍繞硬分叉激活時間的細節存在相當大的混亂。這三個月的期限是 NYA 中提到的六個月期限的一半，該期限最初是在 BTC1 客戶端的早期版本中實現的。通過與一些 BTC1 內部人士的交談，我確定這一變化的原因顯然是為了讓人們在 SegWit 激活後更少的時間退出硬分叉，這將有助於確保硬分叉發生。

至於 BTC1 客戶端，即使在實施 BIP 91 之後，它似乎也充滿了錯誤。 Jeff 可能不了解 SegWit，並且在 SegWit 的點對點層上犯了一些錯誤，需要進一步輸入才能修復。此外，值得注意的是，正如有人在 6 月 14 日的電子郵件中指出的那樣，BTC1 客戶端甚至沒有實施硬分叉塊大小限制的增加。客戶保留了 400 萬個單位的重量上限，這可以防止硬分叉並確保區塊大小限制永遠不會增加。似乎 Jeff 從未理解新的 SegWit 限制：記住，他曾認為 SegWit 有兩個限制。只有在指出這一點後，發布第一版BTC1，它才真正實現了硬分叉。事實證明，NYA 的支持者很難將他們不理解的事情加倍。

傑夫也面臨著為 BTC1 客戶端添加重放保護的巨大壓力，但他反對這樣做。這個想法不是 BTC1 會創造一個新的硬幣，而是升級後只有一個硬幣，並且由於對新鏈的壓倒性支持，原始規則鏈以某種方式消亡。2016 年的以太坊分裂現在是古老的歷史，大多數大型阻止者似乎已經忘記了它。因此，在 NYA 支持者的心目中，重放保護是沒有必要的。然而，這是多年來一直在圈子裡轉來轉去的相同論點的重演。有些人認為原始規則鏈可能會佔上風，因此需要重放保護。6 月 14 日，NYA 基於其提議的塞爾吉奧·勒納 (Sergio Lerner) 全力支持重放保護。至此，

> *有兩組人對比特幣有兩種不同的看法。這些願景沒有一個是“錯誤的”。一個群體更重視權力下放、缺乏政府、抗審查、匿名等更多東西。該團體認為比特幣將在 20-30 年內改變我們的世界。為了達到這個目標，堅持這些價值觀是非常重要的。不用著急。另一組重視更多事情，例如在未來 5 年內達到 10 億用戶，或者今天為真正的無銀行賬戶用戶提供服務，即使現在需要達成政治協議。這兩種願景都有其優點。但它們是不相容的。重放保護為這些“比特幣者”中的每一個提供了一個機會，以充分推動他們自己的願景。兩種願景可以共存。（原文如此）*

2017 年 6 月 16 日，礦工們又召開了一次圓桌會議。幾乎所有主要礦池都出席了會議。在會議上，礦工們同意支持NYA。

BTC1 的第一個版本沒有擦除保護，正如本書前面所解釋的那樣，推動一個沒有擦除保護的有爭議的硬分叉就像是故意將雙手反綁在身後進行戰爭。到了 2017 年 5 月，經過近兩年的爭奪戰，吳忌寒終於意識到了這一點，並推動了全滅保護。Jihan 早在 2017 年 5 月 12 日就已經支持擦除保護：

> *由於這是一個非常重要的共識規則變化，已經爭論了 4 年，我們可以在並且僅在分叉高度添加另一個共識規則，塊的大小必須大於 1,000,000 字節。這是保護 Re-Org 的一種非常簡單直接的方法* 。

隨著對 Jeff 的壓力越來越大，而且 NYA 硬分叉似乎比其發起人最初想像的更具爭議性，他同意增加擦除保護。Jihan 曾鼓勵 Jeff 將此功能添加到 BTC1 中，並且在 6 月 20 日，Jeff 遵守了。BTC1 現在不僅允許硬分叉後的塊大於 1 MB，還要求第一個塊大於 1 MB，這是擦除保護的基本形式。

> *比特大陸和 BU 要求實施反擦除功能；我和其他工作組成員通過創建更可預測的網絡升級的更廣泛的理由表示同意。*

> …

> *傳統的 HF 序列是網絡分叉發生在 * HF 規則更改時或之後，當礦工創建第一個大於 1M 的塊時。建議收緊這一點，以便當規則更改發生時，HF 塊*必須*大於 1M。這通過保證分叉在區塊 X 上發生，從而使事件更具可預測性。*

此功能實施不佳，2017 年 7 月 11 日，BTC1 測試網一分為二。看來有人開採測試網塊的速度比預期快 50 倍，提前激活了硬分叉。然後，由於“大於 1 MB”規則的實施方式存在錯誤，要求第一個區塊大於 1 MB 的較新版本 BTC1 與舊 BTC1 客戶端拆分到不同的鏈上。這是因為第一個區塊不超過 1 MB，因為交易不足。這個錯誤和分裂再次被小攔截器利用來表明 BTC1 是一個弱且有問題的客戶端。BTC1 團隊通過表明這就是測試網的用途來為自己辯護。然而，這確實說明了一點：BTC1 試圖以倉促和隨意的時間表改變比特幣的共識規則，並在短時間內發布了多個客戶端，

到 7 月初，大約 80% 到 95% 的礦工（按哈希算力）在他們開采的區塊中包含字母“NYA”，NYA 看起來處於領先地位。然而，幾乎沒有用戶運行 BTC1 甚至 Segnet（僅限 NYA 的第一部分）；採用率接近於零。與此同時，我採訪過的主要交易所都沒有運行 BTC1、Segnet 或 BIP 148 客戶端；他們只是在運行比特幣核心。因此，前景似乎高度不確定。

事實上，儘管有 NYA 的標誌，但我與之交談的礦工和礦池也沒有運行 BTC1。2017 年 7 月中旬，我與兩個礦池的人進行了交談，他們在 2017 年 6 月簽署了 NYA 和新的挖礦圓桌協議。只是為了解釋一下，如果礦工正在運行 BTC1，他們應該在此時默認標記第 4 位和第 1 位；一旦第一個軟分叉激活，位 1 將成為強制性的並激活 SegWit。這些礦工告訴我，他們不信任 BTC1 客戶端，因此正在運行 Segnet 或 Bitcoin Core。那些運行比特幣核心的人手動包含了 NYA 標誌和第 4 位和/或第 1 位。我被告知這是最高機密，並與我秘密分享；礦工們解釋說，在公開場合，表達對 BTC1 和 NYA 的支持至關重要。

7 月 20 日，季寒在推特上表示，比特大陸正在運行 BTC1；只不過，此時他還表示，比特大陸已經修改了軟件，去掉了 bit 1 標誌。Jihan 似乎熱衷於堅持到激活 SegWit 之前的最後一刻，以確保它在投票成為強制性之前不會激活。

> *比特大陸正在運行 Btc1 軟件，但我們修改為僅在此階段僅對第 4 位進行投票。*

標記顯然是一團糟，礦工到處都在標記，誤導用戶他們實際運行的內容。例如，礦池在不運行 BTC1 的情況下表示支持 NYA。在誤報方面，比特大陸也是最嚴重的違規者之一。例如，Antpool（比特大陸的礦池）實際上在 BTC1 的 alpha 版本發布之前標記了第 4 位，表明它正在使用一個尚不存在的客戶端。即使在 2017 年 7 月，Bitmain 仍在標記對 Bitcoin Unlimited 的支持，當時該節點尚未實施 BTC1 或 SegWit，因此它們的標記是矛盾的。

幾天后，也就是 2017 年 7 月末，比特大陸終於標記為第 1 位，就在截止日期前幾天。小阻攔者欣喜若狂。經過艱苦的競選活動，即隔離見證發布 10 多個月後，該領域最大的礦工終於表示支持它。大多數小型阻滯劑都認為這永遠不會發生。SegWit 激活現在看起來很有可能。

最終實現了 BIP 91 的 80% 閾值，並於 2017 年 7 月 21 日鎖定。根據這項新的臨時軟分叉規則，礦工必須從 2017 年 7 月 26 日起標記對 SegWit 的支持。隨著該日期的臨近，一些比特幣人擔心風險升高。如果並非所有礦工都遵守，則可能存在網絡問題。然而，這一天到來了，所有礦工都遵守了，標記了第 1 位。沒有鏈分裂，隔離見證最終被鎖定，然後在比特幣網絡上激活。由於這種瘋狂的混亂和相互關聯的截止日期和激活機制的複雜性，幾乎不可能跟踪正在發生的事情。似乎每隔幾天就會有某種激活機製或截止日期。如果你已經讀了這本書，你可能很明顯，至少可以說，我對這場衝突非常著迷；然而，在這一點上，即使我發現跟踪正在發生的事情也很有挑戰性。

BIP 91 在 BIP 148 截止日期 2017 年 8 月 1 日之前激活，在 BIP 91 強制標記 SegWit 與 UASF 做同樣的事情之間只剩下了五天的微小差距。這種接近似乎表明 UASF 的威脅已經奏效。UASF 的成功是一項奇蹟般的成就。現代大衛對歌利亞的勝利。UASF 從未在比特幣核心版本中實施，一些最有影響力的比特幣核心開發人員公開反對它。

本著比特幣及其化名創造者中本聰的真正精神，UASF 並不是在大型參與者之間的官方、閉門、圓桌會議上出現的。相反，它是公開發布的，並由化名開發人員 Shaolinfry 推廣。不知何故，一個匿名個人、幾個草根鐵桿追隨者和 Samson Mow 委託的幾頂帽子，與由許多其他資本充足的企業支持的數十億美元的企業（比特大陸）正面交鋒，並贏得了勝利。我記得我認為這樣的事情只會發生在比特幣中。比特幣的戰場是獨一無二的，因此可以得到一些非常奇特的結果。

從較小的攔截器的角度來看，BIP 91 升級遠非完美；太匆忙了，336 個區塊的投票窗口太小（只有 2.33 天），強制礦工信號有風險，而且至關重要的是，只有礦工在運行 BIP 91，這使得升級非常不穩定。這可能導致礦工和用戶被留在不同的鏈上。無論如何，無論這個過程多麼混亂和危險，小阻撓者還是得逞了：SegWit 已經激活，UASF 似乎強迫了 Jihan 的手。他們現在可以專注於阻止 NYA 的第二階段，即硬分叉。

大型阻撓者對這些事態發展感到憤怒。一位著名的大型阻撓者親自向我提到“愚蠢的 UASF 帽子已經起作用”並迫使礦工激活 SegWit。他對這一切都發生在 8 月 1 日之前這一事實感到特別沮喪。如果它發生在那個日期之後，NYA 導致 SegWit 而不是 UASF 激活的大型阻滯劑敘述會更引人注目。大型阻止者認為小型阻止者運動的最極端部分已經控制了比特幣並激活了他們非常不滿意的東西。在這一點上，他們似乎對比特幣感到幻滅，甚至對 NYA 的第二階段也沒有特別困擾。

在我看來，也許季寒可能錯過了一個技巧。他本可以等到 8 月 1 日的最後期限過去，然後在比特幣上激活 SegWit。這將使小型阻止者更難支持 BIP 148 鏈，因為無論如何 SegWit 都會在另一條鏈上激活。吉汗可以爭辯說他已經擊敗了 UASF。然而，季寒選擇不這樣做，原因似乎是UASF起作用了。季寒怕斷鍊，可能是高估了對手的實力，迫於壓力。

隨著 SegWit 的激活，小型攔截器可以非常自由地在他們的比特幣鏈上前進。然而，仍然存在一個問題，即該領域的許多重要公司，尤其是美國和風投支持的公司，已承諾增加硬分叉區塊大小。他們不希望這是一種新的替代硬幣；他們希望這是比特幣。讓這些公司讓步看起來可能非常困難。因此，區塊大小戰爭繼續進行。這次硬分叉本應在短短三個月內發生，戰場正在升溫。